<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitc.dream_com.mapper.ReviewMapper">

    <!--    기능 : 리뷰 보기
            최종 수정일 : 2023.01.19
            최종 작성자 : 김영민 -->
    <select id="review" resultType="com.bitc.dream_com.dto.ReviewDto">
        SELECT detail_review.review_num, detail_review.user_id, detail_review.content, detail_review.product_num, detail_review.createDt,
               detail_review.img_path, detail_review.score, detail_review.like_count, user.user_id, noise_review.n_review_msg, packaging_review.p_review_msg,
               delivery_review.d_review_msg, spec_review.s_review_msg
        FROM detail_review
                 JOIN user ON detail_review.user_id = user.user_id
                 JOIN simple_review ON detail_review.review_num = simple_review.review_num
                 JOIN noise_review ON simple_review.n_review_num = noise_review.n_review_num
                 JOIN delivery_review ON simple_review.d_review_num = delivery_review.d_review_num
                 JOIN packaging_review ON simple_review.p_review_num = packaging_review.p_review_num
                 JOIN spec_review ON simple_review.s_review_num = spec_review.s_review_num;
    </select>

<!--    리뷰 평점 보기-->
<!--    최종 수정일 2023-01-20-->
<!--    최종 작성자 : 양민호-->
    <select id="getScore" resultType="com.bitc.dream_com.dto.ReviewDto">
        select score from detail_review where product_num = #{productNum}
    </select>

    <insert id="insertDetailReview" parameterType="com.bitc.dream_com.dto.ReviewDto">
        INSERT INTO detail_review(score, user_id, product_num, content, createDt, img_path)
        VALUES (#{score}, 'test2', #{productNum}, #{content}, NOW(), #{imgPath});
    </insert>

    <insert id="insertSimpleReview" parameterType="com.bitc.dream_com.dto.ReviewDto">
        INSERT INTO simple_review(review_num, d_review_num,s_review_num,n_review_num,p_review_num)
        VALUES (#{reviewNum}, #{dReviewNum}, #{sReviewNum}, #{nReviewNum}, #{pReviewNum});
    </insert>

    <select id="selectReviewNum" resultType="com.bitc.dream_com.dto.ReviewDto">
        SELECT review_num FROM detail_review
        WHERE user_id = 'test1' AND product_num = #{productNum}
        ORDER BY createDt DESC
            LIMIT 1;
    </select>
</mapper>